const defaultOptions = {
  filename: 'index.html',
  template: () => `
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="utf-8">
        <title></title>
      </head>
      <body>
      </body>
    </html>
  `,
};

/**
 * A webpack plugin that allows a developer to create files generated by functions.
 */
class VirtualFilePlugin {
  /**
   * The constructor
   *
   * @param {Object[]} options - Configuration options
   * @param {string} options[].filename - The served file's name, can contain a path
   * @param {Function} options[].template - A function that returns a string to be used as the
   *                                        content for the file
   */
  constructor(options) {
    this.options = Object.assign({}, defaultOptions, options);
  }

  apply(compiler) {
    compiler.plugin('emit', (compilation, callback) => {
      const content = this.options.template();

      compilation.assets[this.options.filename] = { // eslint-disable-line no-param-reassign
        source: () => content,
        size: () => content.length,
      };

      callback();
    });
  }
}

module.exports = VirtualFilePlugin;
